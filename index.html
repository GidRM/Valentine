<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ’— Valentine</title>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Playfair+Display:wght@400;600&display=swap");
  </style>

  <style>
    :root{
      --rose-quartz:#F9CBD6;
      --blush:#F2AFBC;
      --red-wine:#9E182B;
      --oat-milk:#F2E0D2;

      --ink:#2a1f22;
      --shadow: 0 18px 60px rgba(158,24,43,.18);
      --ring: rgba(158,24,43,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background: var(--rose-quartz);
      overflow:hidden;
      font-family: "Playfair Display", ui-serif, Georgia, serif;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 20% 18%, rgba(242,175,188,.55), transparent 60%),
        radial-gradient(800px 520px at 85% 25%, rgba(242,224,210,.75), transparent 62%),
        radial-gradient(900px 620px at 55% 88%, rgba(158,24,43,.12), transparent 60%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
      opacity:.42;
      transform: translateZ(0);
    }

    /* ---------- LAYOUT ---------- */
    .app{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:18px;
      position:relative;
    }

    .card{
      width:min(92vw, 520px);
      background: rgba(255,247,248,.92);
      border: 1px solid rgba(158,24,43,.10);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 22px 18px;
      backdrop-filter: blur(10px);
      position:relative;
    }

    .title{
      font-family:"Baloo 2", ui-sans-serif, system-ui, sans-serif;
      font-weight:800;
      font-size: 34px;
      line-height:1.05;
      margin: 6px 0 8px;
      letter-spacing:.2px;
      color: #2b171d;
      text-shadow: 0 10px 20px rgba(158,24,43,.10);
    }

    .subtitle{
      margin:0 0 16px;
      font-size:16px;
      line-height:1.35;
      opacity:.9;
    }

    .btnRow{
      position:relative;
      height: 210px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      gap:16px;
      padding-top: 6px;
    }

    .btn{
      width: min(44vw, 170px);
      max-width: 170px;
      aspect-ratio: 1/1;
      border-radius: 22px;
      border: 2px solid rgba(158,24,43,.14);
      background: rgba(242,224,210,.85);
      box-shadow: 0 14px 30px rgba(158,24,43,.12);
      cursor:pointer;
      font-family:"Baloo 2", ui-sans-serif, system-ui, sans-serif;
      font-weight:800;
      font-size: 28px;
      letter-spacing: .08em;
      color:#2a1f22;
      display:grid;
      place-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, filter .12s ease;
      position:relative;
    }
    .btn:active{transform:scale(.985)}
    .btn:focus{outline:none; box-shadow: 0 0 0 4px var(--ring), 0 14px 30px rgba(158,24,43,.12);}

    .btnYes{
      background: linear-gradient(180deg, rgba(242,224,210,.95), rgba(242,175,188,.72));
      border-color: rgba(158,24,43,.10);
    }
    .btnYes span{color:var(--red-wine)}

    .btnNo{
      background: rgba(242,175,188,.35);
      border-color: rgba(158,24,43,.10);
      color: rgba(42,31,34,.85);
    }

    .btnNo.is-floating{
      position:absolute;
      left: 55%;
      top: 22%;
      transform: translate(-50%,-50%) scale(1);
      margin:0;
      z-index:3;
      touch-action: manipulation;
    }

    .hint{
      text-align:center;
      margin-top: 12px;
      font-size:12px;
      opacity:.65;
    }

    /* ---------- INTRO (LOADING) ---------- */
    .intro{
      position:fixed; inset:0;
      display:grid; place-items:center;
      background: var(--rose-quartz);
      z-index:50;
      transition: opacity .35s ease;
    }
    .intro.fade{opacity:0; pointer-events:none;}
    .introInner{
      width:min(92vw, 520px);
      display:grid;
      place-items:center;
      padding: 24px 16px;
    }
    .balloonWrap{
      width:min(320px, 76vw);
      position:relative;
      filter: drop-shadow(0 22px 40px rgba(158,24,43,.22));
      transform: translateZ(0);
    }

    .curtain{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:60;
      overflow:hidden;
      opacity:0;
    }
    .curtain.show{opacity:1;}
    .glitter{
      position:absolute;
      top:-12vh;
      font-size: 14px;
      opacity: .95;
      filter: drop-shadow(0 10px 12px rgba(158,24,43,.18));
      animation: fall linear forwards;
      will-change: transform, opacity;
    }
    @keyframes fall{
      0%{ transform: translateY(-12vh) translateX(0) rotate(0deg); opacity:0;}
      10%{ opacity:1;}
      100%{ transform: translateY(120vh) translateX(var(--drift, 0px)) rotate(360deg); opacity:1;}
    }

    .pop{
      animation: pop .28s ease forwards;
      transform-origin: 50% 55%;
    }
    @keyframes pop{
      0%{transform: scale(1)}
      70%{transform: scale(1.06)}
      100%{transform: scale(.02); opacity:0}
    }

    /* ---------- MODALS ---------- */
    .modalBackdrop{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      padding:18px;
      background: rgba(158,24,43,.12);
      backdrop-filter: blur(7px);
      z-index:80;
    }
    .modalBackdrop.show{display:grid;}
    .modal{
      width:min(92vw, 520px);
      background: rgba(255,247,248,.96);
      border: 1px solid rgba(158,24,43,.12);
      border-radius: 26px;
      box-shadow: 0 26px 80px rgba(158,24,43,.22);
      padding: 18px 16px;
    }
    .modalTitle{
      font-family:"Baloo 2", ui-sans-serif, system-ui, sans-serif;
      font-weight:800;
      font-size: 26px;
      margin: 2px 0 8px;
      color:#2b171d;
    }
    .modalText{
      margin:0;
      font-size: 16px;
      line-height:1.45;
      opacity:.92;
    }
    .modalActions{
      margin-top:14px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }
    .smallBtn{
      border:0;
      cursor:pointer;
      padding: 10px 14px;
      border-radius: 16px;
      font-family:"Baloo 2", ui-sans-serif, system-ui, sans-serif;
      font-weight:800;
      font-size: 14px;
      letter-spacing:.04em;
      background: rgba(242,175,188,.55);
      color: var(--red-wine);
      border:1px solid rgba(158,24,43,.10);
      box-shadow: 0 12px 24px rgba(158,24,43,.12);
    }

    /* Final modal (no exit) */
    .finalBackdrop{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      padding:18px;
      background: rgba(158,24,43,.14);
      backdrop-filter: blur(8px);
      z-index:90;
    }
    .finalBackdrop.show{display:grid;}
    .final{
      width:min(92vw, 560px);
      background: rgba(255,247,248,.97);
      border: 1px solid rgba(158,24,43,.12);
      border-radius: 28px;
      box-shadow: 0 34px 110px rgba(158,24,43,.26);
      padding: 18px 16px;
      max-height: 82vh;
      overflow:auto;
    }

    .finalGif{
      display:block;
      width:min(260px, 70vw);
      height:auto;
      margin: 4px auto 10px;
      border-radius: 18px;
      border: 1px solid rgba(158,24,43,.10);
      box-shadow: 0 18px 46px rgba(158,24,43,.18);
    }

    .final p{margin:0 0 10px; line-height:1.45;}
    .heartList{
      list-style:none;
      padding:0;
      margin: 10px 0 0;
    }
    .heartList li{
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin: 10px 0;
      line-height:1.4;
      font-size: 15px;
    }
    .heartBullet{
      flex:0 0 auto;
      width:18px; height:18px;
      margin-top: 3px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), transparent 40%),
        radial-gradient(circle at 70% 70%, rgba(158,24,43,.18), transparent 45%),
        linear-gradient(180deg, #F2AFBC, #F9CBD6);
      clip-path: path("M9 16 C9 16 1 11 1 6.5 C1 3.4 3.1 1.2 6 1.2 C7.6 1.2 8.8 2 9 2.3 C9.2 2 10.4 1.2 12 1.2 C14.9 1.2 17 3.4 17 6.5 C17 11 9 16 9 16 Z");
      filter: drop-shadow(0 6px 10px rgba(158,24,43,.12));
    }

    /* ---------- Candy rain (YES) ---------- */
    .rainLayer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:85;
      overflow:hidden;
      display:none;
    }
    .rainLayer.show{display:block;}
    .candy{
      position:absolute;
      top:-14vh;
      width: 34px; height: 34px;
      opacity: .98;
      animation: candyFall linear forwards;
      will-change: transform, opacity;
      filter: drop-shadow(0 14px 18px rgba(158,24,43,.18));
    }
    .candy.small{width:26px; height:26px; opacity:.92}
    .candy.big{width:44px; height:44px}
    @keyframes candyFall{
      0%{ transform: translateY(-14vh) translateX(0) rotate(0deg); opacity:0;}
      8%{opacity:1;}
      100%{ transform: translateY(120vh) translateX(var(--sway, 0px)) rotate(520deg); opacity:1;}
    }

    @media (prefers-reduced-motion: reduce){
      .glitter, .candy, .pop{animation:none !important;}
      .intro{transition:none;}
    }
  </style>
</head>

<body>
  <!-- INTRO -->
  <div class="intro" id="intro">
    <div class="introInner">
      <div class="balloonWrap" id="balloonWrap" aria-label="Loading">
        <svg viewBox="0 0 420 420" width="100%" height="auto" role="img" aria-label="Heart balloon">
          <defs>
            <path id="heartPath" d="M210 365
              C210 365 55 275 55 155
              C55 95 98 60 150 60
              C182 60 204 78 210 88
              C216 78 238 60 270 60
              C322 60 365 95 365 155
              C365 275 210 365 210 365 Z" />

            <clipPath id="clipHeart"><use href="#heartPath" /></clipPath>

            <radialGradient id="gloss" cx="28%" cy="26%" r="55%">
              <stop offset="0%" stop-color="white" stop-opacity=".85"/>
              <stop offset="35%" stop-color="white" stop-opacity=".22"/>
              <stop offset="65%" stop-color="white" stop-opacity="0"/>
            </radialGradient>

            <linearGradient id="balloonBase" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#F2AFBC"/>
              <stop offset="55%" stop-color="#F9CBD6"/>
              <stop offset="100%" stop-color="#F2E0D2"/>
            </linearGradient>

            <linearGradient id="fillGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#9E182B"/>
              <stop offset="40%" stop-color="#F2AFBC"/>
              <stop offset="100%" stop-color="#F9CBD6"/>
            </linearGradient>

            <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="18" stdDeviation="18" flood-color="#9E182B" flood-opacity=".18"/>
            </filter>
          </defs>

          <use href="#heartPath" fill="url(#balloonBase)" filter="url(#softShadow)"/>
          <g clip-path="url(#clipHeart)">
            <rect id="fillRect" x="0" y="0" width="0" height="420" fill="url(#fillGrad)"></rect>
          </g>
          <use href="#heartPath" fill="url(#gloss)" opacity=".95"/>
          <use href="#heartPath" fill="none" stroke="#9E182B" stroke-opacity=".18" stroke-width="6"/>

          <text x="210" y="212" text-anchor="middle"
                font-family="Baloo 2, system-ui, sans-serif"
                font-weight="800"
                font-size="52"
                letter-spacing="6"
                fill="#F2E0D2"
                opacity=".95"
                style="paint-order: stroke; stroke: rgba(158,24,43,.18); stroke-width: 10;">
            I LOVE YOU
          </text>

          <path d="M200 360 C205 372 215 372 220 360" fill="none" stroke="#9E182B" stroke-opacity=".22" stroke-width="6" stroke-linecap="round"/>
          <path d="M210 372 C210 395 210 410 210 420" fill="none" stroke="#9E182B" stroke-opacity=".18" stroke-width="5" stroke-linecap="round"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Glitter curtain -->
  <div class="curtain" id="curtain" aria-hidden="true"></div>

  <!-- App -->
  <main class="app" id="app" aria-hidden="true">
    <section class="card" id="card">
      <h1 class="title">Will you be my Valentine?</h1>
      <p class="subtitle">Because love comes in many forms and you're one of my favorite humans to exist</p>

      <div class="btnRow" id="btnRow">
        <button class="btn btnYes" id="yesBtn" type="button"><span>YES</span></button>
        <button class="btn btnNo" id="noBtn" type="button">NO</button>
      </div>

      <div class="hint">Cute. Delicate. Slightly sarcastic. Highly affectionate.</div>
    </section>
  </main>

  <!-- "NO click" modal (dismissible) -->
  <div class="modalBackdrop" id="noModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="noModalTitle">
      <div class="modalTitle" id="noModalTitle">Nope ðŸ’—</div>
      <p class="modalText">NO button had commitment issue. Try again</p>
      <div class="modalActions">
        <button class="smallBtn" id="noModalOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <!-- Candy rain layer -->
  <div class="rainLayer" id="rainLayer" aria-hidden="true"></div>

  <!-- Final modal (no exit) -->
  <div class="finalBackdrop" id="finalBackdrop" aria-hidden="true">
    <div class="final" role="dialog" aria-modal="true" aria-labelledby="finalTitle">
      <!-- GIF ABOVE the title -->
      <img
        class="finalGif"
        src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGI4OGlpbGR1bWd4amticHdvbXV1MGZvczRuazI1OTF3bXdsa3E0eiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/WK7omsLop0431tZjXb/giphy.gif"
        alt="Cute gif"
        loading="lazy"
      />

      <div class="modalTitle" id="finalTitle">Congratulations. Youâ€™re Stuck With Me ðŸ’ž</div>

      <p class="modalText" style="margin-top:6px;">
        By accepting, you've renewed our friendship for another year with access to the membership that offers:
      </p>

      <ul class="heartList">
        <li>
          <span class="heartBullet" aria-hidden="true"></span>
          <span>
            We celebrate love without the pressure, the drama (only other people's), or the weird couples' photoshoot
            <em>(maybe you'll still have to do a few photoshoots, but they'll be iconic)</em>
          </span>
        </li>

        <li>
          <span class="heartBullet" aria-hidden="true"></span>
          <span>
            You receive unlimited emotional and delululuuuu support, memes, and hype.
          </span>
        </li>

        <li>
          <span class="heartBullet" aria-hidden="true"></span>
          <span>
            The best service any partner could ever offer you.
          </span>
        </li>

        <li>
          <span class="heartBullet" aria-hidden="true"></span>
          <span>
            Bonus: food. Always fantastic food.
          </span>
        </li>
      </ul>
    </div>
  </div>

<script>
/* ---------------- INTRO: balloon fill -> pop -> glitter curtain reveals page ---------------- */
(function(){
  const intro = document.getElementById("intro");
  const app = document.getElementById("app");
  const fillRect = document.getElementById("fillRect");
  const balloonWrap = document.getElementById("balloonWrap");
  const curtain = document.getElementById("curtain");

  window.addEventListener("load", () => {
    try{ navigator.vibrate?.(30); }catch(e){}
  });

  const durationMs = 3800; // longer loading
  const start = performance.now();

  function tick(now){
    const t = Math.min(1, (now - start) / durationMs);
    fillRect.setAttribute("width", String(420 * t));
    if(t < 1){
      requestAnimationFrame(tick);
    }else{
      balloonWrap.classList.add("pop");
      startGlitterCurtain();

      setTimeout(() => {
        app.removeAttribute("aria-hidden");
        intro.classList.add("fade");
      }, 120);

      setTimeout(() => {
        intro.style.display = "none";
      }, 4800);
    }
  }
  requestAnimationFrame(tick);

  function startGlitterCurtain(){
    curtain.classList.add("show");
    curtain.innerHTML = "";

    const symbols = ["âœ¨","âœ¦","âœ§","â‹†","ðŸ’—","ðŸ’–","â€¢","Â·"];
    const count = 320;

    for(let i=0;i<count;i++){
      const el = document.createElement("div");
      el.className = "glitter";
      el.textContent = symbols[Math.floor(Math.random()*symbols.length)];

      const x = Math.random()*100;
      const size = 10 + Math.random()*18;
      const dur = 2.6 + Math.random()*2.0;
      const delay = Math.random()*0.65;
      const drift = (Math.random()*90 - 45).toFixed(1) + "px";

      el.style.left = x + "vw";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      el.style.animationDelay = delay + "s";
      el.style.setProperty("--drift", drift);

      const tint = Math.random();
      el.style.color = (tint < 0.72) ? "#F2AFBC" : (tint < 0.93) ? "#F2E0D2" : "#9E182B";
      curtain.appendChild(el);
    }

    setTimeout(() => {
      curtain.classList.remove("show");
      curtain.innerHTML = "";
    }, 4600);
  }
})();

/* ---------------- MAIN: NO bounces + shrinks; YES triggers candy rain + final modal ---------------- */
(function(){
  const btnRow = document.getElementById("btnRow");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");

  const noModalBackdrop = document.getElementById("noModalBackdrop");
  const noModalOk = document.getElementById("noModalOk");

  const rainLayer = document.getElementById("rainLayer");
  const finalBackdrop = document.getElementById("finalBackdrop");

  let noActive = false;
  let noDisabled = false;
  let x = 0, y = 0, vx = 1.7, vy = 1.4;
  let scale = 1;

  // Mobile â€œlet them click sometimesâ€ logic:
  // 0.0 = always dodge (almost never clickable)
  // 1.0 = never dodge (always clickable)
  const ALLOW_CLICK_CHANCE_ON_TAP = 0.18; // ~18% chance a tap is allowed to become a click

  setTimeout(() => startNoFloating(), 500);

  function startNoFloating(){
    if(noActive) return;
    noActive = true;
    noBtn.classList.add("is-floating");

    const rect = btnRow.getBoundingClientRect();
    x = rect.width * 0.62;
    y = rect.height * 0.35;
    applyNoTransform();
    requestAnimationFrame(step);
  }

  function step(){
    if(!noActive) return;

    const rect = btnRow.getBoundingClientRect();
    const btn = noBtn.getBoundingClientRect();

    const minX = 10;
    const minY = 10;
    const maxX = rect.width - btn.width - 10;
    const maxY = rect.height - btn.height - 10;

    x += vx;
    y += vy;

    if(x <= minX){ x = minX; vx *= -1; }
    if(x >= maxX){ x = maxX; vx *= -1; }
    if(y <= minY){ y = minY; vy *= -1; }
    if(y >= maxY){ y = maxY; vy *= -1; }

    applyNoTransform();
    requestAnimationFrame(step);
  }

  function applyNoTransform(){
    noBtn.style.left = x + "px";
    noBtn.style.top = y + "px";
    noBtn.style.transform = `translate(0,0) scale(${scale})`;
  }

  function dodge(){
    if(!noActive) startNoFloating();
    if(noDisabled) return;

    scale = Math.max(0.32, scale * 0.92);
    vx *= (Math.random() < 0.5 ? 1.06 : -1.06);
    vy *= (Math.random() < 0.5 ? 1.06 : -1.06);

    const rect = btnRow.getBoundingClientRect();
    x = Math.max(10, Math.min(rect.width - 60, x + (Math.random()*160 - 80)));
    y = Math.max(10, Math.min(rect.height - 60, y + (Math.random()*140 - 70)));
    applyNoTransform();
    try{ navigator.vibrate?.(10); }catch(e){}
  }

  // Desktop hover = always dodge
  noBtn.addEventListener("mouseenter", () => { if(!noDisabled) dodge(); });
  noBtn.addEventListener("pointerenter", (e) => {
    // On touch, pointerenter can be noisy; only treat as hover for non-touch pointers.
    if(e.pointerType !== "touch" && !noDisabled) dodge();
  });

  // Mobile tap: MOSTLY dodge, SOMETIMES allow the click to happen
  noBtn.addEventListener("touchstart", () => {
    if(noDisabled) return;
    // Delay a hair so the browser can still produce a "click" if we decide to allow it.
    setTimeout(() => {
      if(Math.random() > ALLOW_CLICK_CHANCE_ON_TAP) dodge();
    }, 40);
  }, {passive:true});

  // If someone actually clicks NO: show popup, then disable NO clicks (only YES clickable)
  noBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    if(noDisabled) return;
    showNoModal();
    noDisabled = true;
    noBtn.style.pointerEvents = "none";
    noBtn.style.filter = "grayscale(.25)";
    noBtn.style.opacity = ".65";
  });

  function showNoModal(){
    noModalBackdrop.classList.add("show");
    noModalBackdrop.setAttribute("aria-hidden","false");
    try{ navigator.vibrate?.([15,20,15]); }catch(e){}
  }
  function hideNoModal(){
    noModalBackdrop.classList.remove("show");
    noModalBackdrop.setAttribute("aria-hidden","true");
  }
  noModalOk.addEventListener("click", hideNoModal);

  // YES click: NO disappears first, then candy rain, then final modal
  yesBtn.addEventListener("click", ()=>{
    yesBtn.disabled = true;
    yesBtn.style.filter = "saturate(1.05)";

    // NO disappears BEFORE the YES animation
    noBtn.style.display = "none";
    noActive = false;

    try{ navigator.vibrate?.([20,40,20]); }catch(e){}

    startCandyRain();

    // Delay final modal so the candy rain is clearly visible
    setTimeout(() => {
      finalBackdrop.classList.add("show");
      finalBackdrop.setAttribute("aria-hidden","false");
    }, 4200);
  });

  // --- Candy SVG assets (inline via data-URI) ---
  const svgCandyHeart = encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="#F2AFBC"/>
          <stop offset="0.6" stop-color="#F9CBD6"/>
          <stop offset="1" stop-color="#F2E0D2"/>
        </linearGradient>
        <radialGradient id="h" cx="26%" cy="22%" r="55%">
          <stop offset="0" stop-color="#fff" stop-opacity=".85"/>
          <stop offset=".45" stop-color="#fff" stop-opacity=".2"/>
          <stop offset="1" stop-color="#fff" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <path d="M32 56S8 42 8 24c0-7 5-12 12-12 6 0 10 3 12 7 2-4 6-7 12-7 7 0 12 5 12 12 0 18-24 32-24 32z"
        fill="url(#g)" stroke="#9E182B" stroke-opacity=".18" stroke-width="2.4"/>
      <path d="M32 52S12 40 12 25c0-5 4-9 9-9 4 0 7 2 8 5 1-3 4-5 8-5 5 0 9 4 9 9 0 15-20 27-20 27z"
        fill="url(#h)" opacity=".9"/>
    </svg>
  `);

  const svgGummyBear = encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <defs>
        <linearGradient id="gb" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="#F9CBD6"/>
          <stop offset="1" stop-color="#F2AFBC"/>
        </linearGradient>
        <radialGradient id="shine" cx="30%" cy="22%" r="60%">
          <stop offset="0" stop-color="#fff" stop-opacity=".85"/>
          <stop offset=".42" stop-color="#fff" stop-opacity=".22"/>
          <stop offset="1" stop-color="#fff" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <path d="M20 18c-4 0-7-3-7-7s3-7 7-7c2 0 4 1 5 2 1-1 3-2 5-2 4 0 7 3 7 7s-3 7-7 7H20z"
        fill="url(#gb)" opacity=".95"/>
      <path d="M44 18c-4 0-7-3-7-7s3-7 7-7c2 0 4 1 5 2 1-1 3-2 5-2 4 0 7 3 7 7s-3 7-7 7H44z"
        fill="url(#gb)" opacity=".95"/>
      <path d="M32 16c-12 0-18 7-18 18v6c0 10 8 18 18 18s18-8 18-18v-6c0-11-6-18-18-18z"
        fill="url(#gb)" stroke="#9E182B" stroke-opacity=".14" stroke-width="2.2"/>
      <path d="M21 46c-5 0-9 4-9 9s4 9 9 9c3 0 6-2 7-4 1 2 4 4 7 4 5 0 9-4 9-9s-4-9-9-9H21z"
        fill="url(#gb)" opacity=".9"/>
      <path d="M44 46c-5 0-9 4-9 9s4 9 9 9c3 0 6-2 7-4 1 2 4 4 7 4 5 0 9-4 9-9s-4-9-9-9H44z"
        fill="url(#gb)" opacity=".9"/>
      <circle cx="26" cy="28" r="9" fill="url(#shine)" opacity=".85"/>
    </svg>
  `);

  const svgMarshmallow = encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <defs>
        <linearGradient id="m" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#F2E0D2"/>
          <stop offset=".5" stop-color="#F9CBD6"/>
          <stop offset="1" stop-color="#F2AFBC"/>
        </linearGradient>
        <radialGradient id="mh" cx="30%" cy="25%" r="60%">
          <stop offset="0" stop-color="#fff" stop-opacity=".85"/>
          <stop offset=".5" stop-color="#fff" stop-opacity=".18"/>
          <stop offset="1" stop-color="#fff" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <path d="M12 40c0-10 10-18 20-18s20 8 20 18-10 18-20 18S12 50 12 40z"
        fill="url(#m)" stroke="#9E182B" stroke-opacity=".12" stroke-width="2"/>
      <path d="M18 38c3-7 10-12 18-12s15 5 18 12c-3 7-10 12-18 12s-15-5-18-12z"
        fill="url(#mh)" opacity=".85"/>
    </svg>
  `);

  function startCandyRain(){
    rainLayer.classList.add("show");
    rainLayer.innerHTML = "";

    const types = [
      { kind:"heart", src:`data:image/svg+xml,${svgCandyHeart}` },
      { kind:"bear",  src:`data:image/svg+xml,${svgGummyBear}` },
      { kind:"mash",  src:`data:image/svg+xml,${svgMarshmallow}` },
      { kind:"spark", src:null }
    ];

    const total = 180;
    const baseDur = 7.2;
    const durJitter = 4.5;

    for(let i=0;i<total;i++){
      const t = types[Math.floor(Math.random()*types.length)];
      const el = document.createElement("div");
      el.className = "candy";

      const r = Math.random();
      if(r < .35) el.classList.add("small");
      else if(r > .88) el.classList.add("big");

      const x = Math.random()*100;
      const dur = baseDur + Math.random()*durJitter;
      const delay = Math.random()*3.0;
      const sway = (Math.random()*160 - 80).toFixed(1) + "px";

      el.style.left = x + "vw";
      el.style.animationDuration = dur + "s";
      el.style.animationDelay = delay + "s";
      el.style.setProperty("--sway", sway);

      if(t.kind === "spark"){
        el.style.width = "18px";
        el.style.height = "18px";
        el.style.background = "transparent";
        el.style.filter = "drop-shadow(0 12px 16px rgba(158,24,43,.16))";
        el.textContent = (Math.random() < .5) ? "âœ¨" : "âœ¦";
        el.style.fontSize = (12 + Math.random()*16) + "px";
        el.style.color = (Math.random() < .8) ? "#F2AFBC" : "#F2E0D2";
        el.style.display = "grid";
        el.style.placeItems = "center";
      }else{
        el.style.backgroundImage = `url("${t.src}")`;
        el.style.backgroundSize = "contain";
        el.style.backgroundRepeat = "no-repeat";
        el.style.backgroundPosition = "center";
      }

      rainLayer.appendChild(el);
    }

    setTimeout(() => {
      rainLayer.classList.remove("show");
      rainLayer.innerHTML = "";
    }, 16000);
  }
})();
</script>
</body>
</html>
